<div class="profile-container">
  <h2>Mon Profil</h2>

  <div class="back-to-dashboard-container">
    <button class="button-primary" (click)="navigateToDashboard()">‚¨ÖÔ∏è Retour au Dashboard</button>
  </div>

  @if (currentUser) {
    <div class="profile-section">
      <h3>Informations Personnelles</h3>
      <p><strong>Nom :</strong> {{ currentUser.firstname }} {{ currentUser.lastname }}</p>
      <p><strong>Email :</strong> {{ currentUser.email }}</p>
      <p><strong>R√¥le :</strong> {{ currentUser.role }}</p>

      @if (personDetails) {
        <h4>D√©tails suppl√©mentaires :</h4>
        <p><strong>Genre :</strong> {{ personDetails.genre }}</p>
        <p><strong>√Çge :</strong> {{ personDetails.age }}</p>
      }
    </div>

    <div class="profile-section">
      <h3>S√©curit√©</h3>
      <p>
        <strong>Mot de passe :</strong>
        @if (!showPasswordForm) {
          <span>‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
          <button (click)="togglePasswordForm()" class="btn btn-secondary btn-sm">Changer</button>
        }
      </p>

      @if (showPasswordForm) {
        <form (ngSubmit)="handleChangePassword()" class="password-form">
          <div class="form-group">
            <label for="currentPassword">Mot de passe actuel (simulation) :</label>
            <input type="password" id="currentPassword" name="currentPassword" [(ngModel)]="currentPassword" required>
          </div>

          <div class="form-group">
            <label for="newPassword">Nouveau mot de passe :</label>
            <div class="password-input-group">
              <input [type]="passwordFieldType" id="newPassword" name="newPassword" [(ngModel)]="newPassword" required minlength="6">
              <button type="button" (click)="togglePasswordVisibility()" class="btn-show-hide">
                {{ passwordFieldType === 'password' ? 'üëÅÔ∏è' : 'üôà' }}
              </button>
            </div>
          </div>

          <div class="form-group">
            <label for="confirmNewPassword">Confirmer le nouveau mot de passe :</label>
            <input [type]="passwordFieldType" id="confirmNewPassword" name="confirmNewPassword" [(ngModel)]="confirmNewPassword" required>
          </div>

          @if (passwordChangeMessage) {
            <p class="message" [class.success]="passwordChangeMessage.includes('succ√®s')" [class.error]="!passwordChangeMessage.includes('succ√®s')">
              {{ passwordChangeMessage }}
            </p>
          }

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Enregistrer</button>
            <button type="button" class="btn btn-cancel" (click)="togglePasswordForm()">Annuler</button>
          </div>
        </form>
      }
    </div>

    <div class="profile-section">
      <h3>Mes Promos</h3>
      @if (userPromos.length > 0) {
        <ul>
          @for (promo of userPromos; track promo.id) {
            <li>
              <strong>{{ promo.nom }}</strong>
              @if (promo.formateurName) {
                <p class="formateur-info">Formateur assign√© : <strong>{{ promo.formateurName }}</strong></p>
              } @else {
                <p class="formateur-info">Aucun formateur principal assign√© √† cette promo.</p>
              }
            </li>
          }
        </ul>
      } @else {
        <p>Vous n'√™tes assign√©(e) √† aucune promo pour le moment.</p>
      }
    </div>
  } @else {
    <p>Chargement des informations du profil...</p>
  }
</div>
